<include file="public@header"/>
<style>
.table img{
	width:25px;
	height:25px;
}

#pop{
    display:none; 
}
</style>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a>{:lang('USER_INDEXADMIN_INDEX')}</a></li>
        <li><a href="{:url('adminIndex/add')}">{:lang('ADD')}</a></li>
    </ul>
    <form class="well form-inline margin-top-20" method="post" action="{:url('user/adminIndex/index')}">
    
        <!--僵尸粉开关：-->
        <!--<select class="form-control" name="iszombie">-->
            <!--<option value="">全部</option>-->
                <!--<option value="1" <if condition="input('request.iszombie') neq '' && input('request.iszombie') eq 1">selected</if>>开启</option>-->
                <!--<option value="0" <if condition="input('request.iszombie') neq '' && input('request.iszombie') eq 0">selected</if>>关闭</option>-->
        <!--</select>-->
        
        <!--僵尸粉：-->
        <!--<select class="form-control" name="iszombiep">-->
            <!--<option value="">全部</option>-->
                <!--<option value="1" <if condition="input('request.iszombiep') neq '' && input('request.iszombiep') eq 1">selected</if>>是</option>-->
                <!--<option value="0" <if condition="input('request.iszombiep') neq '' && input('request.iszombiep') eq 0">selected</if>>否</option>-->
        <!--</select>-->
        
        禁用：
        <select class="form-control" name="isban">
            <option value="">全部</option>
                <option value="1" <if condition="input('request.isban') neq '' && input('request.isban') eq 1">selected</if>>是</option>
                <option value="0" <if condition="input('request.isban') neq '' && input('request.isban') eq 0">selected</if>>否</option>
        </select>
        
        <!--热门：-->
        <!--<select class="form-control" name="ishot">-->
            <!--<option value="">全部</option>-->
                <!--<option value="1" <if condition="input('request.ishot') neq '' && input('request.ishot') eq 1">selected</if>>是</option>-->
                <!--<option value="0" <if condition="input('request.ishot') neq '' && input('request.ishot') eq 0">selected</if>>否</option>-->
        <!--</select>-->
        
        认证状态：
        <select class="form-control" name="is_auth">
            <option value="">全部</option>
                <option value="1" <if condition="input('request.is_auth') neq '' && input('request.is_auth') eq 1">selected</if>>是</option>
                <option value="0" <if condition="input('request.is_auth') neq '' && input('request.is_auth') eq 0">selected</if>>否</option>
        </select>
        设备来源：
        <select class="form-control" name="source">
            <option value="">全部</option>
                <option value="pc" <if condition="input('request.source') neq '' && input('request.source') eq 'pc'">selected</if>>PC</option>
                <option value="android" <if condition="input('request.source') neq '' && input('request.source') eq 'android'">selected</if>>安卓APP</option>
                <option value="ios" <if condition="input('request.source') neq '' && input('request.source') eq 'ios'">selected</if>>苹果APP</option>
        </select>

        提交时间：
        <input class="form-control js-bootstrap-date" name="start_time" id="start_time" value="{:input('request.start_time')}" aria-invalid="false" style="width: 110px;"> - 
        <input class="form-control js-bootstrap-date" name="end_time" id="end_time" value="{:input('request.end_time')}" aria-invalid="false" style="width: 110px;">
            
        用户ID：
        <input class="form-control" type="text" name="uid" style="width: 200px;" value="{:input('request.uid')}"
               placeholder="请输入用户ID">

        超管：
        <select class="form-control" name="is_super">
            <option value="">全部</option>
            <option value="1" <if condition="input('request.is_super') neq '' && input('request.is_super') eq 1">selected</if>>是</option>
            <option value="0" <if condition="input('request.is_super') neq '' && input('request.is_super') eq 0">selected</if>>否</option>
        </select>

        关键字：
        <input class="form-control" type="text" name="keyword" style="width: 200px;" value="{:input('request.keyword')}"
               placeholder="用户名/昵称">
        <input type="submit" class="btn btn-primary" value="搜索"/>
        <a class="btn btn-danger" href="{:url('user/adminIndex/index')}">清空</a>
    </form>
    <form method="post" class="js-ajax-form">
        <!--<div class="table-actions">-->
            <!--<button class="btn btn-danger btn-sm js-ajax-submit" type="submit" data-action="{:url('user/adminIndex/setzombiepall',array('iszombiep'=>1))}"-->
                    <!--data-subcheck="true" data-msg="您确定要进行此操作吗？">批量设置为僵尸粉-->
            <!--</button>-->
            <!--<button class="btn btn-danger btn-sm js-ajax-submit" type="submit" data-action="{:url('user/adminIndex/setzombiepall',array('iszombiep'=>0))}"-->
                    <!--data-subcheck="true" data-msg="您确定要进行此操作吗？">批量取消僵尸粉-->
            <!--</button>-->
            <!---->
            <!--<button class="btn btn-danger btn-sm js-ajax-submit" type="submit" data-action="{:url('user/adminIndex/setzombieall',array('iszombie'=>1))}" data-msg="您确定要进行此操作吗？">一键开启僵尸粉-->
            <!--</button>-->
            <!--<button class="btn btn-danger btn-sm js-ajax-submit" type="submit" data-action="{:url('user/adminIndex/setzombieall',array('iszombie'=>0))}" data-msg="您确定要进行此操作吗？">一键关闭僵尸粉-->
            <!--</button>-->
        <!--</div>-->
        <table class="table table-hover table-bordered">
            <thead>
            <tr>
                <th width="16">
                    <label>
                        <input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x">
                    </label>
                </th>
                <th>ID</th>
                <th>头像</th>
                <th>昵称</th>
                <th>所属公会</th>
                <th>魅力等级</th>
                <th>财富等级</th>
                <th>消费丫币</th>
                <th>当前丫币</th>
                <th>消费丫粮</th>
                <th>当前丫粮</th>
                <th>上次登录</th>
                <th>拥有靓号</th>
                <th>备注</th>
                <th>直播权重</th>
                <th>主播标识</th>
                <th>加V时间</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <php>
                $user_statuses=array("0"=>lang('USER_STATUS_BLOCKED'),"1"=>lang('USER_STATUS_ACTIVATED'),"2"=>lang('USER_STATUS_UNVERIFIED'));
            </php>
            <foreach name="list" item="vo">
                <tr>
                    <td>
                        <input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}">
                    </td>
                    <td>{$vo.id}</td>
                    <td><img src="{$vo['avatar']}"/></td>
                    <td>{$vo['user_nicename']?$vo['user_nicename']:lang('NOT_FILLED')}</td>
                    <td>{$vo.family_name ? : "暂无"}</td>
                    <td>{$vo.level_anchor}</td>
                    <td>{$vo.level}</td>
                    <td>{$vo.consumption}</td>
                    <td>{$vo.coin}</td>
                    <td>{$vo.spend_votes}</td>
                    <td>{$vo.votes}</td>
                    <td>{:date('Y-m-d H:i:s',$vo['last_login_time'])}</td>
                    <td>{$vo.liang_num}<a href="javascript:openDealDialog('userliang?uid={$vo['id']}','查看靓号');">查看</a></td>
                    <td>$vo.remark</td>
                    <td>$vo.live_weight</td>
                    <td>{$vo.v}</td>
                    <td>{$vo.v_time}</td>
                    <td>
                        <if condition="$vo.user_status eq 0">
                            <span class="label label-danger">{$user_statuses[0]}</span>
                        <else/>
                            <span class="label label-success">{$user_statuses[1]}</span>
                        </if>
                    </td>
                    <td>
                        <if condition="$vo.user_status eq 0">
                            <a class="btn btn-xs btn-success js-ajax-dialog-btn"
                                   href="{:url('adminIndex/cancelban',array('id'=>$vo['id']))}"
                                   data-msg="{:lang('ACTIVATE_USER_CONFIRM_MESSAGE')}">{:lang('ACTIVATE_USER')}</a>
                        <else/>
                            <a class="btn btn-xs btn-warning js-ajax-dialog-btn"
                                   href="{:url('adminIndex/ban',array('id'=>$vo['id']))}"
                                   data-msg="您确定要封该账号吗？">封号</a>
                        </if>

                        <if condition="$vo.verify eq '1'">
                            <a class="btn btn-xs btn-info js-ajax-dialog-btn"
                               href="{:url('admin/remark/delUser',array('uid'=>$vo['id']))}">取消标识</a>
                            <a href="javascript:openDealDialog('remarklist?uid={$vo['id']}','添加认证标识');">更换标识</a>
                            <else/>
                            <a href="javascript:openDealDialog('remarklist?uid={$vo['id']}','添加认证标识');">标识设置</a>
                        </if>

                        <if condition="$vo.is_agent eq '1'">
                            <a class="btn btn-xs btn-info js-ajax-dialog-btn"
                               href="{:url('adminIndex/agent',array('id'=>$vo['id'],'is_agent'=>0))}">取消代理</a>
                            <else/>
                            <a class="btn btn-xs btn-info js-ajax-dialog-btn"
                               href="{:url('adminIndex/agent',array('id'=>$vo['id'],'is_agent'=>1))}">设置代理</a>
                        </if>
                        
                        <!--<if condition="$vo.iszombie eq '1'">-->
                            <!--<a class="btn btn-xs btn-info js-ajax-dialog-btn"-->
                                   <!--href="{:url('adminIndex/setzombie',array('id'=>$vo['id'],'iszombie'=>0))}">关闭僵尸粉</a>-->
                        <!--<else/>-->
                            <!--<a class="btn btn-xs btn-info js-ajax-dialog-btn"-->
                                   <!--href="{:url('adminIndex/setzombie',array('id'=>$vo['id'],'iszombie'=>1))}">开启僵尸粉</a>-->
                        <!--</if>-->
                        
                        <!--<if condition="$vo.iszombiep eq '1'">-->
                            <!--<a class="btn btn-xs btn-info js-ajax-dialog-btn"-->
                                   <!--href="{:url('adminIndex/setzombiep',array('id'=>$vo['id'],'iszombiep'=>0))}">取消设置僵尸粉</a>-->
                        <!--<else/>-->
                            <!--<a class="btn btn-xs btn-info js-ajax-dialog-btn"-->
                                   <!--href="{:url('adminIndex/setzombiep',array('id'=>$vo['id'],'iszombiep'=>1))}">设置为僵尸粉</a>-->
                        <!--</if>-->
                        
                        <a class="btn btn-xs btn-primary" href='{:url("adminIndex/edit",array("id"=>$vo["id"]))}'>{:lang('EDIT')}</a>
                        <if condition="$vo.is_limit eq '1'">
                            <a class="btn btn-xs btn-primary" href='{:url("admin/iplimit/switch",array("uid"=>$vo["id"], "status" => 0))}'>解封IP</a>
                        <else/>
                            <a class="btn btn-xs btn-primary" href='{:url("admin/iplimit/addPost",array("ip"=>$vo["last_login_ip"]))}'>封禁IP</a>
                        </if>
                        <if condition="$vo.is_super eq '1'">
                            <a class="btn btn-xs btn-primary" href='{:url("user/adminIndex/setsuperV2",array("uid"=>$vo["id"], "type" => 2))}'>取消超管</a>
                            <else/>
                            <a class="btn btn-xs btn-primary" href='{:url("user/adminIndex/setsuperV2",array("uid"=>$vo["id"], "type" => 1))}'>设置为超管</a>
                        </if>
                        <!--<if condition="$vo.is_auth eq '1'">-->
                            <!--<a href="javascript:openDealDialog('weight?uid={$vo['id']}','添加直播权重');">直播权重</a>-->
                        <!--</if>-->
                        <!--<a class="btn btn-xs btn-danger js-ajax-delete" href="{:url('adminIndex/del',array('id'=>$vo['id']))}">{:lang('DELETE')}</a>-->
                    </td>
                </tr>
            </foreach>
            </tbody>
        </table>
        <div class="pagination">{$page}</div>
    </form>
</div>

<div id="pop">
    <div class="wrap" style="padding-bottom:40px;">
        <form method="post" class="form-horizontal margin-top-20">
            <div class="form-group">
                <label for="input-user_login" class="col-sm-2 control-label"><span class="form-required">*</span>禁用截止日期</label>
                <div class="col-md-6 col-sm-10">
                    <input class="form-control js-bootstrap-date" name="ban_long" id="ban_long" value="" aria-invalid="false">
                </div>
            </div>
            
            <div class="form-group">
                <label for="input-user_login" class="col-sm-2 control-label"><span class="form-required">*</span>禁用原因</label>
                <div class="col-md-6 col-sm-10">
                    <textarea class="form-control" id="ban_reason" name="ban_reason" ></textarea> 
                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <a href="javascript:void(0)" class="btn btn-primary" onclick="xiajia_submit()">禁用</a>
                </div>
            </div>
        </form>
    </div>
</div>
            
<script src="__STATIC__/js/admin.js"></script>
<script src="__STATIC__/js/laydate/laydate.js"></script>
<script>
        Wind.use('layer');
		var clickuid='0';
		function showlayer(id){
			clickuid=id;
            layer.open({
                type: 1,
                title: '禁用',
                shadeClose: true,
                shade: 0.8,
                area: ['800px', '300px'],
                content: $('#pop'),
                success:function(){
                    laydate.render({
                        elem: '#ban_long',//指定元素
                        trigger: 'click'
                    });
                }
            }); 
		}
	
		
		var xiajia_status=0;
		function xiajia_submit(){
			var ban_long=$("#ban_long").val();
			var reason=$("#ban_reason").val();
			if(xiajia_status==1){
				return;
			}
			xiajia_status=1;
			$.ajax({
				url: '{:url('user/adminIndex/setBan')}',
				type: 'POST',
				dataType: 'json',
				data: {id:clickuid,reason: reason,ban_long:ban_long},
				success:function(data){
					var code=data.code;
					if(code==0){
						layer.msg(data.msg);
						return !1;
					}

					xiajia_status=0;
					
					layer.msg("操作成功",{},function(){
						//layer.closeAll();
                        clickuid=0;
						$("#ban_long").val("");
						$("#ban_reason").attr("value","");
						layer.closeAll();
                        reloadPage(window);
					});
				},
				error:function(e){
				}
			});
			
		}
</script>
</body>
</html>